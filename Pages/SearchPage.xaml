<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:controls="clr-namespace:MTGFetchMAUI.Controls"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             x:Class="MTGFetchMAUI.Pages.SearchPage"
             x:Name="SearchPageRoot"
             Title="Search"
             BackgroundColor="{StaticResource Background}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,*">

        <!-- Search Bar -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto,Auto"
              Padding="8,8,8,4" ColumnSpacing="8">
            <material:TextField x:Name="SearchEntry"
                   Title="Search cards..."
                   Text="{Binding SearchText, Mode=TwoWay}"
                   ReturnCommand="{Binding SearchCommand}"
                   BackgroundColor="{StaticResource Surface}"
                   TextColor="{StaticResource TextPrimary}"
                   TitleColor="{StaticResource TextSecondary}"
                   AccentColor="{StaticResource Primary}"
                   HeightRequest="50"
                   AllowClear="True">
            </material:TextField>

            <Button Grid.Column="1"
                    Text="Search"
                    IsVisible="False"
                    Command="{Binding SearchCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                    HeightRequest="44"
                    Padding="16,0" StyleClass="ElevatedButton" />

            <Button Grid.Column="2"
                    Text="Filters"
                    Command="{Binding GoToFiltersCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                    BackgroundColor="{StaticResource CardBackground}"
                    HeightRequest="44"
                    Padding="12,0" StyleClass="ElevatedButton" />

            <Button Grid.Column="3"
                    Text="{Binding ViewModeButtonText}"
                    Command="{Binding ToggleViewModeCommand}"
                    BackgroundColor="{StaticResource CardBackground}"
                    HeightRequest="44"
                    WidthRequest="44"
                    Padding="0"
                    FontSize="18"
                    StyleClass="ElevatedButton" />
        </Grid>

        <!-- Status Bar -->
        <Grid Grid.Row="1" Padding="8,0,8,4">
            <Label x:Name="StatusLabel"
                   Text="{Binding StatusMessage}"
                   TextColor="{StaticResource TextSecondary}"
                   FontSize="12" />
            <ActivityIndicator x:Name="LoadingIndicator"
                               IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               HorizontalOptions="End"
                               HeightRequest="20"
                               WidthRequest="20"
                               Color="{StaticResource Primary}" />
        </Grid>

        <!-- Card Grid -->
        <controls:CardGrid Grid.Row="2"
                           x:Name="CardGrid"
                           Scrolled="OnGridScrolled" />

        <!-- Overlays -->
        <controls:CollectionAddSheet Grid.RowSpan="3" x:Name="AddSheet" ZIndex="1000" HorizontalOptions="Fill" VerticalOptions="Fill" />
        <controls:Snackbar Grid.RowSpan="3" x:Name="GridSnackbar" ZIndex="1001" HorizontalOptions="Fill" VerticalOptions="Fill" />

    </Grid>

</ContentPage>
