<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:controls="clr-namespace:MTGFetchMAUI.Controls"
             x:Class="MTGFetchMAUI.Pages.SearchPage"
             x:Name="SearchPageRoot"
             Title="Search"
             BackgroundColor="{StaticResource Background}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,*">

        <!-- Search Bar -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto"
              Padding="8,8,8,4" ColumnSpacing="8">
            <Entry x:Name="SearchEntry"
                   Placeholder="Search cards..."
                   Text="{Binding SearchText, Mode=TwoWay}"
                   ReturnType="Search"
                   ReturnCommand="{Binding SearchCommand}"
                   BackgroundColor="{StaticResource Surface}"
                   TextColor="{StaticResource TextPrimary}"
                   PlaceholderColor="{StaticResource TextSecondary}"
                   HeightRequest="44">
                <Entry.Behaviors>
                    <toolkit:UserStoppedTypingBehavior
                        Command="{Binding BindingContext.SearchCommand, Source={x:Reference SearchPageRoot}}"
                        StoppedTypingTimeThreshold="750"
                        MinimumLengthThreshold="3"
                        ShouldDismissKeyboardAutomatically="False" />
                </Entry.Behaviors>
            </Entry>

            <Button Grid.Column="1"
                    Text="Search"
                    Command="{Binding SearchCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                    HeightRequest="44"
                    Padding="16,0" />

            <Button Grid.Column="2"
                    Text="Filters"
                    Command="{Binding GoToFiltersCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                    BackgroundColor="{StaticResource CardBackground}"
                    HeightRequest="44"
                    Padding="12,0" />
        </Grid>

        <!-- Status Bar -->
        <Grid Grid.Row="1" Padding="8,0,8,4">
            <Label x:Name="StatusLabel"
                   Text="{Binding StatusMessage}"
                   TextColor="{StaticResource TextSecondary}"
                   FontSize="12" />
            <ActivityIndicator x:Name="LoadingIndicator"
                               IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               HorizontalOptions="End"
                               HeightRequest="20"
                               WidthRequest="20"
                               Color="{StaticResource Primary}" />
        </Grid>

        <!-- Card Grid -->
        <controls:CardGrid Grid.Row="2"
                           x:Name="CardGrid"
                           Scrolled="OnGridScrolled" />

        <!-- Overlays -->
        <controls:CollectionAddSheet Grid.RowSpan="3" x:Name="AddSheet" ZIndex="1000" HorizontalOptions="Fill" VerticalOptions="Fill" />
        <controls:Snackbar Grid.RowSpan="3" x:Name="GridSnackbar" ZIndex="1001" HorizontalOptions="Fill" VerticalOptions="Fill" />

    </Grid>

</ContentPage>
