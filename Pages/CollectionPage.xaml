<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:MTGFetchMAUI.Controls"
             x:Class="MTGFetchMAUI.Pages.CollectionPage"
             Title="Collection"
             BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,Auto,*">

        <!-- Header -->
        <Grid Grid.Row="0" Padding="12,8" ColumnDefinitions="*,Auto">
            <VerticalStackLayout>
                <Label x:Name="CollectionTitle"
                       Text="My Collection"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextPrimary}" />
                <Label x:Name="CollectionStatus"
                       Text="{Binding StatusDisplayText}"
                       FontSize="12"
                       TextColor="{Binding StatusTextColor}" />
            </VerticalStackLayout>

            <HorizontalStackLayout Grid.Column="1" Spacing="8">
                <ActivityIndicator x:Name="CollectionLoading"
                                   IsRunning="False"
                                   IsVisible="False"
                                   HeightRequest="20"
                                   WidthRequest="20"
                                   Color="{StaticResource Primary}" />
                <Button Text="{Binding ViewModeButtonText}"
                        Command="{Binding ToggleViewModeCommand}"
                        BackgroundColor="{StaticResource CardBackground}"
                        HeightRequest="36"
                        WidthRequest="36"
                        Padding="0"
                        FontSize="18"
                        StyleClass="ElevatedButton" />
                <Button Text="Refresh"
                        Clicked="OnRefreshClicked"
                        BackgroundColor="{StaticResource CardBackground}"
                        HeightRequest="36"
                        Padding="12,0"
                        FontSize="12"
                        StyleClass="ElevatedButton" />
            </HorizontalStackLayout>
        </Grid>

        <!-- Filter + Sort Row -->
        <Grid Grid.Row="1" Padding="8,0,8,6" ColumnDefinitions="*,Auto" ColumnSpacing="8">
            <Entry Placeholder="Filter collection..."
                   Text="{Binding FilterText, Mode=TwoWay}"
                   BackgroundColor="{StaticResource Surface}"
                   TextColor="{StaticResource TextPrimary}"
                   PlaceholderColor="{StaticResource TextSecondary}"
                   HeightRequest="36"
                   FontSize="13"
                   ClearButtonVisibility="WhileEditing" />
            <Picker Grid.Column="1"
                    ItemsSource="{Binding SortModeOptions}"
                    SelectedIndex="{Binding SortModeIndex, Mode=TwoWay}"
                    TextColor="{StaticResource TextPrimary}"
                    BackgroundColor="{StaticResource Surface}"
                    HeightRequest="36"
                    WidthRequest="110"
                    FontSize="13" />
        </Grid>

        <!-- Card Grid -->
        <controls:CardGrid Grid.Row="2"
                           x:Name="CollectionGrid"
                           Scrolled="OnCollectionScrolled" />

        <!-- Empty State -->
        <VerticalStackLayout Grid.Row="2"
                             IsVisible="{Binding IsCollectionEmpty}"
                             VerticalOptions="Center"
                             HorizontalOptions="Center"
                             Spacing="8">
            <Label Text="&#x1F4C2;"
                   FontSize="48"
                   HorizontalOptions="Center" />
            <Label Text="Your collection is empty"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{StaticResource TextPrimary}"
                   HorizontalOptions="Center" />
            <Label Text="Search for cards and long-press to add them"
                   FontSize="13"
                   TextColor="{StaticResource TextSecondary}"
                   HorizontalOptions="Center"
                   HorizontalTextAlignment="Center" />
        </VerticalStackLayout>

    </Grid>

</ContentPage>
